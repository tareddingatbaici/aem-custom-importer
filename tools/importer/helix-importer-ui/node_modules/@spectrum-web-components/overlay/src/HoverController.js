"use strict";import{conditionAttributeWithId as r}from"@spectrum-web-components/base/src/condition-attribute-with-id.js";import{randomID as a}from"@spectrum-web-components/shared/src/random-id.js";import{InteractionController as h,InteractionTypes as d}from"./InteractionController.js";import{noop as s}from"./AbstractOverlay.js";const l=300;export class HoverController extends h{constructor(){super(...arguments);this.type=d.hover;this.elementIds=[];this.focusedin=!1;this.pointerentered=!1}handleTargetFocusin(){var e;(e=document.activeElement)!=null&&e.matches(":focus-visible")&&(this.host.open=!0,this.focusedin=!0)}handleTargetFocusout(){this.focusedin=!1,!this.pointerentered&&(this.host.open=!1)}handleTargetPointerenter(){this.hoverTimeout&&(clearTimeout(this.hoverTimeout),this.hoverTimeout=void 0),!this.host.disabled&&(this.host.open=!0,this.pointerentered=!0)}handleTargetPointerleave(){this.doPointerleave()}handleHostPointerenter(){this.hoverTimeout&&(clearTimeout(this.hoverTimeout),this.hoverTimeout=void 0)}handleHostPointerleave(){this.doPointerleave()}prepareDescription(){if(!this.host.elements.length)return;const e=this.target.getRootNode(),t=this.host.elements[0].getRootNode(),o=this.host.getRootNode();e===o?this.prepareOverlayRelativeDescription():e===t&&this.prepareContentRelativeDescription()}prepareOverlayRelativeDescription(){const e=r(this.target,"aria-describedby",[this.host.id]);this.releaseDescription=()=>{e(),this.releaseDescription=s}}prepareContentRelativeDescription(){const e=[],t=this.host.elements.map(i=>(e.push(i.id),i.id||(i.id=`${this.host.tagName.toLowerCase()}-helper-${a()}`),i.id));this.elementIds=e;const o=r(this.target,"aria-describedby",t);this.releaseDescription=()=>{o(),this.host.elements.map((i,n)=>{i.id=this.elementIds[n]}),this.releaseDescription=s}}doPointerleave(){this.pointerentered=!1;const e=this.target;this.focusedin&&e.matches(":focus-visible")||(this.hoverTimeout=setTimeout(()=>{this.host.open=!1},l))}init(){var t;(t=this.abortController)==null||t.abort(),this.abortController=new AbortController;const{signal:e}=this.abortController;this.target.addEventListener("focusin",()=>this.handleTargetFocusin(),{signal:e}),this.target.addEventListener("focusout",()=>this.handleTargetFocusout(),{signal:e}),this.target.addEventListener("pointerenter",()=>this.handleTargetPointerenter(),{signal:e}),this.target.addEventListener("pointerleave",()=>this.handleTargetPointerleave(),{signal:e}),this.host.addEventListener("pointerenter",()=>this.handleHostPointerenter(),{signal:e}),this.host.addEventListener("pointerleave",()=>this.handleHostPointerleave(),{signal:e})}}
//# sourceMappingURL=HoverController.js.map
